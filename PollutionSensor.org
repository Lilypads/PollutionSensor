-*- line-spacing: 0.1; -*-
#+TITLE: Pollution Sensor
#+STARTUP: latexpreview
#+STARTUP: show2levels
#+INCLUDE: "~/.doom.d/orgReportHeader.org"
#+OPTIONS: H:3 d:nil tags:nil email:t toc:t broken-links:t ^:nil #\n:t

* Table Of Contents :TOC_2:
- [[#overview][Overview]]
  - [[#objectives][Objectives]]
  - [[#road-map-011][Road Map]]
  - [[#useage][Useage]]
  - [[#capabilities][Capabilities]]
-  [[#misc][Misc]]
  - [[#i2c-on-pi][I2C On Pi]]
  - [[#links][Links]]
  - [[#repo][Repo]]
- [[#hardware][Hardware]]
  - [[#pi-hat][Pi Hat]]
  - [[#particle-sensor][Particle Sensor]]
  - [[#gps-module][GPS Module]]
  - [[#i2c-display][I2C Display]]
  - [[#storage-device][Storage Device]]
  - [[#battery][Battery]]
  - [[#hold-rotary-encoder][HOLD Rotary Encoder]]
- [[#software][Software]]
  - [[#usage-state-machine][Usage State Machine]]
  - [[#user-interface][User Interface]]
  - [[#particle-sensor-library][Particle Sensor Library]]
  - [[#gps-library][GPS Library]]

* Overview
[[file:Figures/PollutionSensor_HighLevelDiagram.png]]
** Objectives
*** User Stories
** Road Map [0/11]
- [ ] Hardware setup
- [ ] Finalise Libraries
- [ ] WAN SSH Setup
- [ ] Define Interface
- [ ] UML Diagramming
- [ ] Continuous delivery/Integration (testing)
- [ ] Command-line Menu System
- [ ] Display Based Menu System
- [ ] Menu System
- [ ] GPS Logging
- [ ] Data Upload
** Useage
*** States
- Off
- Initialising
- Acquiring
#+begin_src plantuml :file Figures/PollotionUsecaseDiagram.png
!theme cyborg-outline
[*] --> Initialisation
state Initialisation {
        [*] --> AcquireGps
        [*] --> test
        }
#+end_src

#+RESULTS:
[[file:Figures/PollotionUsecaseDiagram.png]]

** Capabilities
*  Misc
** I2C On Pi
*** enable raspberry Pi i2c Interface
- Run the following Command:
#+begin_src bash
sudo rasp-config
#+end_src
- Select interface options
- Enable I2C kernel module
*** Look for I2C devices
#+begin_src bash
i2cdetect -y 1
#+end_src
** Links
** [[https://github.com/Lilypads/PollutionSensor][Repo]]
* Hardware
** Pi Hat
*** Overview
- Centralises the hardware interfaces into one place
- Plugs into Raspberry Pi's Pin Header
- includes buttons/ or rotary encoder
- Pin header (female) for display daughter board
- 4 way JST-XH plugs for particle sensor + GPS Module
*** Hardware Interfaces
**** TODO Particle Sensor
- 6 way JST-XS header
**** I2C Display
- 4 way female Pin Header (2.54mm Pin Pitch)
 [[file:Figures/FemalePinHeader.jpg]]
  Pin Definition From the Front
  | GND | Vcc (3.3V) | SCK | SDA |
**** Push Buttons
- three total according to the following menu actions:
  + up
  + down
  + enter
**** WAIT Rotary Encoder
** Particle Sensor
*** Hardware Overview
- ID :: SPS30
- Vendor :: Sensirion
- Interface :: I2C
- Plug :: JST XS 6 way
*** Hardware interface
*** *[[file:Hardware/ParticleSensor/SENSIRION_datasheet.pdf][SPS30 Datasheet]]
** GPS Module
[[file:Figures/NEO-6M.png]]
*** Overview
- ID :: NEO-6M
- Vendor :: u-blox
- Interface :: UART
- Plug :: 2.54mm pin header
- Vcc Voltage :: 3.6V max
*** Hardware Interface Details
**** Breakout board
- [[https://uk.pi-supply.com/products/ublox-neo-6m-gps-uart-module-breakout-with-antenna][GPS breakout board]]
- 5 way Male Pin header
 From Front Pins at bottom
| Pin Name | Pin Description       |
|----------+-----------------------|
| Vcc 3.3V | Supply Voltage        |
| GND      | Ground                |
| TXD 3.3v | Transmit (Out of GPS) |
| RXD 3.3v | Receive (Into GPS)    |
| PPS      | Interrupt?            |
*** [[file:Hardware/GPSModule/NEO-6_DataSheet.pdf][NEO6 Datasheet]]
*** TODO Libraries (Software Interface)
** I2C Display
[[file:Figures/OledDisplay.png]]
- 128\times64 Pixel Monochrome Oled
- I2C
*** I2C
| Address      |    0x3C |
| Interface IC | SSD1306 |

*** Libraries
**** candidates
- https://github.com/bitbank2/ss_oled
  + good feature-set
  + 128 stars on github
  + good documentation
  + Depends on BitBang_I2C library
  + last commit one month ago
- https://github.com/iliapenev/ssd1306_i2c
  + 33 stars
  + 22 forks - lots of forks for not very many stars
  + last commit 2016
*** [[file:Resource/SSD1306.pdf][SSD1306 Datasheet]]

** TODO Storage Device
- Use onboard SD Card
** Battery
- Currently Just a USB Power Brick
** HOLD Rotary Encoder
* Software
** Usage State Machine
** User Interface
*** Menu System
**** Menu State Machine
*** Configurable Options
*** Live Display
** Particle Sensor Library
** GPS Library
- UART
*** GPSD
- https://gpsd.gitlab.io/gpsd/index.html
- Service Daemon
- Doesn't explicitly say that NEO6M is supported but I saw forum users say it was
*** libgps
- https://github.com/wdalmut/libgps
*** ublox
- https://github.com/GAVLab/ublox
